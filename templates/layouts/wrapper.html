<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>{% if pageTitle %}{{ pageTitle }} â€“ {% endif %}Gregory Schier</title>
  <meta name="author" content="Gregory Schier">
  <meta name="description" content="{{ pageDescription }}">

  {# Meta #}
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <link rel="canonical" href="{{ pageUrl }}"/>

  {% if pagePublishedTime %}
    <meta property="article:published_time" content="{{ pagePublishedTime }}"/>
  {% endif %}

  {% if pageModifiedTime %}
    <meta property="article:modified_time" content="{{ pageModifiedTime }}"/>
    <meta property="og:updated_time" content="{{ pageModifiedTime }}"/>
  {% endif %}

  {# RSS #}
  <link href="{{ rssUrl }}" rel="alternate" type="application/rss+xml" title="Gregory Schier"/>
  <link href="{{ rssUrl }}" rel="feed" type="application/rss+xml" title="Gregory Schier"/>

  {# Favicon #}
  <link rel="apple-touch-icon" sizes="180x180" href="{{ staticUrl }}/build/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ staticUrl }}/build/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ staticUrl }}/build/favicon/favicon-16x16.png">
  <link rel="manifest" href="{{ staticUrl }}/build/favicon/site.webmanifest">
  <link rel="mask-icon" href="{{ staticUrl }}/build/favicon/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="{{ staticUrl }}/build/favicon/favicon.ico">
  <meta name="msapplication-TileColor" content="#2d89ef">
  <meta name="msapplication-config" content="{{ staticUrl }}/build/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  {# Social Metadata #}
  <meta name="twitter:site" content="@GregorySchier"/>
  <meta name="twitter:creator" content="@GregorySchier"/>
  <meta property="og:url" content="{{ pageUrl }}"/>
  <meta property="og:title" content="{% if pageTitle %}{{ pageTitle }}{% else %}Gregory Schier{% endif %}"/>
  <meta property="og:description" content="{{ pageDescription }}"/>
  {% if pageImage %}
    <meta name="twitter:card" content="summary_large_image"/>
    <meta property="og:image" content="{{ pageImage }}"/>
  {% else %}
    <meta name="twitter:card" content="summary"/>
    <meta property="og:image" content="{{ pageImageDefault }}"/>
  {% endif %}

  {# Scripts and Styles #}
  {% if isDev %}
    {# HMR-able styles/scripts #}
    <script src="{{ staticUrl }}/build/index.js"></script>
    <link rel="stylesheet" href="{{ staticUrl }}/build/index.css">
  {% else %}
    {# inlineable styles #}
    <style>{{ "index.css" | inlineStatic | safe }}</style>
  {% endif %}

  {% block extraStyles %}{% endblock %}
</head>
<body
        data-deployed="{{ deployTime }}"
        data-csrf-token="{{ csrfToken }}"
        data-csrf-Token-header="{{ csrfTokenHeader }}"
        data-logged-in="{{ loggedIn | yesno:'yes,no' }}"
>
{% block body %}{% endblock %}

{% block extraScripts %}{% endblock %}
{% if not doNotTrack %}
  <script>
    (function () {
      const id = (len) => {
        let v = '';
        const chars = 'abcdefghijklmnopqrstuvwxyz01234567890';
        for (let i = 0; i < len; i++) {
          v += chars[Math.floor(Math.random() * chars.length)];
        }
        return v;
      };

      let sess = localStorage.schier ? JSON.parse(localStorage.schier) : {};

      // Check if new session should be created for same user
      if (Date.now() - sess.last > 20 * 60 * 1000) {
        sess = { user: sess.user };
      }

      const prev = sess.prev || '';
      const path = location.pathname;

      // Initialize session properties if new or missing
      sess.id = sess.id || id(10);
      sess.user = sess.user || id(10);
      sess.start = sess.start || Date.now();
      sess.pages = (sess.pages || 0) + 1;
      sess.last = Date.now();
      sess.prev = path;

      // Store session
      localStorage.schier = JSON.stringify(sess);

      // Don't send if the page didn't change
      if (path === prev) {
        console.log('[analytics] Ignore same page');
        return;
      }

      const e = encodeURIComponent;
      fetch('{{ analyticsUrl }}/t?' + [
        `path=${e(path)}`,
        `prev=${e(prev)}`,
        `search=${e(location.search)}`,
        `ref=${e(document.referrer)}`,
        `user=${e(sess.user)}`,
        `sess=${e(sess.id)}`,
        `age=${e(Math.round((Date.now() - sess.start) / 1000))}`,
        `page=${e(sess.pages)}`,
        `lang=${e(navigator.language)}`
      ].join('&'));
    })();
  </script>
{% else %}
  <!-- Analytics Disabled -->
{% endif %}
</body>
</html>
